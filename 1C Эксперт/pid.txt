http://infostart.ru/public/77671/

Код целиком

Если Найти(СтрокаСоединенияИнформационнойБазы(), "Srvr") > 0 Тогда
    // серверный вариант
    Поиск1 = Найти(СтрокаСоединенияИнформационнойБазы(), "Srvr=");
    ПодстрокаПоиска = Сред(СтрокаСоединенияИнформационнойБазы(), Поиск1 + 6);
    ИмяСервера = Лев(ПодстрокаПоиска, Найти(ПодстрокаПоиска, """") - 1);
    // теперь ищем имя базы
    Поиск1 = Найти(СтрокаСоединенияИнформационнойБазы(), "Ref=");
    ПодстрокаПоиска = Сред(СтрокаСоединенияИнформационнойБазы(), Поиск1 + 5);
    ИмяБазы = Лев(ПодстрокаПоиска, Найти(ПодстрокаПоиска, """") - 1);
Иначе
    // для других способов подключения алгоритм не актуален
    Возврат;
КонецЕсли;

Коннектор = Новый COMОбъект("v82.COMConnector");
Агент = Коннектор.ConnectAgent(ИмяСервера);
Кластеры = Агент.GetClusters();
Для каждого Кластер из Кластеры Цикл
    АдминистраторКластера = "Имя администратора кластера";
    ПарольКластера = "Пароль администратора кластера";
    Агент.Authenticate(Кластер, АдминистраторКластера, ПарольКластера);
    Процессы = Агент.GetWorkingProcesses(Кластер);
    Для каждого Процесс из Процессы Цикл
        Порт = Процесс.MainPort;
        // теперь есть адрес и порт для подключения к рабочему процессу
        РабПроц = Коннектор.ConnectWorkingProcess(Имяервера + ":" + СтрЗаменить(Порт, Символы.НПП, ""));
        РабПроц.AddAuthentication("Имя администратора БД", "Пароль администратора БД");

        ИнформационнаяБаза = "";

        Базы = Агент.GetInfoBases(Кластер);
        Для каждого База из Базы Цикл
            Если База.Name = ИмяБазы Тогда
                ИнформационнаяБаза = База;
                Прервать;
            КонецЕсли;
        КонецЦикла;
        Если ИнформационнаяБаза = "" Тогда
            // база не найдена
        КонецЕсли;

        Сеансы = Агент.GetInfoBaseSessions(Кластер, ИнформационнаяБаза);
        Для каждого Сеанс из Сеансы Цикл
            Если нРег(Сеанс.AppID) = "backgroundjob" ИЛИ нРег(Сеанс.AppID) = "designer" Тогда
                // если это сеансы конфигуратора или фонового задания, то не отключаем
                Продолжить;
            КонецЕсли;
            Если Сеанс.UserName = ИмяПользователя() Тогда
                // это текущий пользователь
                Продолжить;
            КонецЕсли;
            Агент.TerminateSession(Кластер, Сеанс);
        КонецЦикла;

        СоединенияБазы = Агент.GetInfoBaseConnections(Кластер, ИнформационнаяБаза);
        // Разорвать соединения клиентских приложений.
        Для Каждого Соединение Из СоединенияБазы Цикл
            Если нРег(Соединение.Application) = "backgroundjob" ИЛИ нРег(Соединение.Application) = "designer" Тогда
                // если это соединение конфигуратора или фонового задания, то не отключаем
                Продолжить;
            КонецЕсли;
            Если Соединение.UserName = ИмяПользователя() Тогда
                // это текущий пользователь
                Продолжить;
            КонецЕсли;
            РабПроц.Disconnect(Соединение);
        КонецЦикла;
    КонецЦикла;
КонецЦикла;